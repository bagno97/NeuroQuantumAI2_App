name: NeuroQuantumAI APK Builder

on:
  workflow_dispatch:

jobs:
  apk_build:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout repo
      uses: actions/checkout@v3

    - name: Set up Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.9'

    - name: Install system dependencies
      run: |
        sudo apt update
        sudo apt install -y build-essential libssl-dev libffi-dev python3-dev \
          python3-pip python3-setuptools git zip unzip openjdk-17-jdk \
          libncurses5 libsqlite3-dev libgdbm-dev libbz2-dev libreadline-dev \
          liblzma-dev zlib1g-dev libjpeg-dev libfreetype6-dev libgl1-mesa-dev \
          libgles2-mesa-dev libpng-dev libSDL2-dev libavcodec-dev libavformat-dev \
          libswscale-dev libpostproc-dev libx11-dev libxcursor-dev libxrandr-dev \
          libxinerama-dev libxi-dev libxxf86vm-dev libxss-dev libglfw3 libglfw3-dev

    - name: Set JAVA_HOME
      run: echo "JAVA_HOME=$(dirname $(dirname $(readlink -f $(which javac))))" >> $GITHUB_ENV

    - name: Install Buildozer
      run: |
        pip install --upgrade pip
        pip install buildozer cython setuptools==65.5.1

    - name: Install Python dependencies
      run: |
        if [ -f requirements.txt ]; then pip install -r requirements.txt; fi

    - name: Build APK
      run: |
        buildozer -v android debug

    - name: Upload APK
      uses: actions/upload-artifact@v3
      with:
        name: NeuroQuantumAI2_App
        path: bin/*.apk
